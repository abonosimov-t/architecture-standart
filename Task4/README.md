# Задание 4. ADR-2

### <a name="_b7urdng99y53"></a>**Название задачи:**  
[ADR-2] Интеграция кол-центров с системой актуальных ставок  

### <a name="_hjk0fkfyohdk"></a>**Автор:**  
Команда цифровой трансформации розничного бизнеса

### <a name="_uanumrh8zrui"></a>**Дата:**  
16.05.2025

---

### <a name="_3bfxc9a45514"></a>**Функциональные требования**  

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| 1 | Бэк-офис, АБС | Обновление ставок | 1. Менеджер бэк-офиса загружает Excel-файл в АБС<br>2. АБС валидирует данные<br>3. Система публикует ставки в Kafka |
| 2 | Кол-центр банка | Получение актуальных ставок | 1. CRM кол-центра подписывается на топик Kafka<br>2. Обновляет кеш ставок каждые 5 минут |
| 3 | Партнёрский кол-центр | Импорт ставок через SFTP | 1. АБС генерирует JSON-файл каждые 15 минут<br>2. Файл шифруется и отправляется на SFTP-сервер<br>3. Партнёр загружает файл в свою CRM |

---

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**  

|**№**|**Требование**|
| :-: | :- |
| 1 | Задержка обновления ставок ≤1 мин (для внутреннего кол-центра) |
| 2 | Шифрование PGP для SFTP-передач |
| 3 | Ротация ключей SFTP каждые 90 дней |
| 4 | Мониторинг целостности файлов (MD5-checksum) |

---

### <a name="_qmphm5d6rvi3"></a>**Решение**  

**Диаграммы C4:**  
##### Диаграмма контекста
![Диаграмма контекста](./C4_Context.svg)

##### Диаграмма контейнеров
![Диаграмма контейнеров](./C4_Container.svg)

### <a name="_bjrr7veeh80c"></a>**Альтернативы**  

**Вариант 1: REST API для партнёра**  
- *Недостатки:* Требует изменений в инфраструктуре партнёра  
- *Риски:* Отказ партнёра от интеграции  

**Вариант 2: Использование Shared DB**  
- *Недостатки:* Нарушение изоляции систем  
- *Ограничения:* Нет поддержки в текущей АБС  

**Недостатки выбранного решения:**  
- Задержка до 15 минут для партнёрского кол-центра  
- Ручная загрузка Excel в АБС  

**Риски:**  
- Расхождение данных при ошибках в Excel-файле  
- Утечка ключей SFTP  

---

### **Список задач**  

| Система | Задачи | Срок | 
|---------|--------|------|
| АБС | Реализация Kafka Producer для ставок | 2 мес |  
| АБС | Разработка SFTP Exporter с PGP | 1.5 мес |  
| Кол-центр | Интеграция с Kafka Consumer | 1 мес |  
| Инфраструктура | Настройка SFTP-сервера | 3 нед |  
| Безопасность | Внедрение ротации ключей | 2 нед |  

---

### **RoadMap**  
![Roadamp на 6 месяцев](./roadmap.svg)

**Годовая перспектива:**
- Автоматизация загрузки ставок из Risk-системы  
- Замена Excel на веб-интерфейс для бэк-офиса  